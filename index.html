<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DexLab - Custom Pokédex Builder</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/pokemon.css">
    <link rel="stylesheet" href="styles/modal.css">
    <link rel="stylesheet" href="styles/flyout.css">
    <link rel="stylesheet" href="libs/fontawesome/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="dexlab.svg">
    <script src="libs/chart.js/chart.umd.min.js"></script>
    <script type="module" src="scripts/app.js"></script>
</head>
<body>
    <!-- Custom SVG Icon Sprite Sheet -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon-box-plot" viewBox="0 0 20 20">
            <path d="M 0 2 L 0 18 L 20 18 L 20 17 L 1 17 L 1 2 L 0 2 z M 18 2 L 18 4 L 17 4 L 17 9 L 18 9 L 18 11 L 19 11 L 19 9 L 20 9 L 20 4 L 19 4 L 19 2 L 18 2 z M 8 4 L 8 6 L 7 6 L 7 11 L 8 11 L 8 13 L 9 13 L 9 11 L 10 11 L 10 6 L 9 6 L 9 4 L 8 4 z M 13 5 L 13 7 L 12 7 L 12 12 L 13 12 L 13 14 L 14 14 L 14 12 L 15 12 L 15 7 L 14 7 L 14 5 L 13 5 z M 18 5 L 19 5 L 19 8 L 18 8 L 18 5 z M 3 7 L 3 9 L 2 9 L 2 14 L 3 14 L 3 16 L 4 16 L 4 14 L 5 14 L 5 9 L 4 9 L 4 7 L 3 7 z M 8 7 L 9 7 L 9 10 L 8 10 L 8 7 z M 13 8 L 14 8 L 14 11 L 13 11 L 13 8 z M 3 10 L 4 10 L 4 13 L 3 13 L 3 10 z"/>
        </symbol>
    </svg>

    <header>
        <div class="header-title">
            <h1>DexLab</h1>
            <span class="title-separator">/</span>
            <span id="dex-name" class="dex-name">Untitled Dex</span>
            <button id="edit-dex-btn" class="icon-btn" title="Edit Pokédex">
                <i class="fas fa-edit"></i>
            </button>
        </div>
        <div class="header-controls">
            <button id="add-pokemon-btn"><i class="fas fa-plus"></i> Add Pokémon</button>
            <div class="actions-dropdown-container">
                <button id="actions-btn" class="actions-btn"><i class="fas fa-ellipsis-v"></i></button>
                <div id="actions-dropdown" class="actions-dropdown">
                    <button id="new-dex-btn"><i class="fas fa-file"></i> Change Dex</button>
                    <button id="export-btn"><i class="fas fa-file-export"></i> Export</button>
                    <button id="print-grid-btn"><i class="fas fa-image"></i> Print Grid</button>
                </div>
            </div>
            <input type="file" id="file-input" style="display: none;" accept=".json">
            <div class="icon-toggle theme-toggle" id="theme-toggle" title="Toggle theme">
                <i class="fas fa-moon"></i>
                <div class="toggle-slider"></div>
                <i class="fas fa-sun"></i>
            </div>
        </div>
    </header>
    <main class="main-content">
        <div id="dashboard" class="dashboard">
            <div class="stat-card" id="stat-count">
                <h3>Count</h3>
                <p id="stat-total-count">-</p>
                <div class="stat-breakdown-row">
                    <div class="stat-breakdown">
                        <label>Evolution Stages</label>
                        <span>1-Stage: <strong id="stat-1stage">-</strong></span>
                        <span>2-Stage: <strong id="stat-2stage">-</strong></span>
                        <span>3-Stage: <strong id="stat-3stage">-</strong></span>
                        <span>Late: <strong id="stat-late-evo">-</strong></span>
                    </div>
                    <div class="stat-breakdown align-right">
                        <label>Special Pokemon</label>
                        <span>Legendary: <strong id="stat-legendary">-</strong></span>
                        <span>Mythical: <strong id="stat-mythical">-</strong></span>
                        <span>Pseudo: <strong id="stat-pseudo">-</strong></span>
                        <span>Total: <strong id="stat-special-total">-</strong></span>
                    </div>
                </div>
            </div>
            <div class="stat-card" id="stat-alerts">
                <h3>
                    Alerts
                    <span class="help-icon" data-tooltip="Alerts highlight unusual patterns in your dex data. These patterns aren't inherently bad; many official regions have them by design. Use alerts as signals to review balance or consider context, not as strict warnings.">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </h3>
                <ul id="alert-list"></ul>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-egg-chart">
                <h3>Egg Group Distribution</h3>
                <div class="chart-container">
                    <canvas id="egg-chart"></canvas>
                </div>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-capture-chart">
                <h3>Capture Rate Distribution</h3>
                <div class="chart-container">
                    <canvas id="capture-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Min: <strong id="min-cr-val">-</strong></span>
                    <span>Q1: <strong id="q1-cr-val">-</strong></span>
                    <span>Median: <strong id="median-cr-val">-</strong></span>
                    <span>Q3: <strong id="q3-cr-val">-</strong></span>
                    <span>Max: <strong id="max-cr-val">-</strong></span>
                </div>
            </div>
            
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-type-chart">
                <h3>Type Distribution</h3>
                <div class="chart-container">
                    <canvas id="type-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Rare: <strong id="rare-type-val">-</strong></span>
                    <span>Common: <strong id="common-type-val">-</strong></span>
                </div>
            </div>
            
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-bst-chart">
                <div class="chart-header">
                    <h3>BST Distribution</h3>
                    <div class="icon-toggle chart-view-toggle" id="bst-chart-toggle" title="Toggle chart view">
                        <i class="fas fa-chart-column"></i>
                        <div class="toggle-slider"></div>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="bst-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Min: <strong id="min-bst-val">-</strong></span>
                    <span>Q1: <strong id="q1-bst-val">-</strong></span>
                    <span>Median: <strong id="median-bst-val">-</strong></span>
                    <span>Q3: <strong id="q3-bst-val">-</strong></span>
                    <span>Max: <strong id="max-bst-val">-</strong></span>
                </div>
            </div>
        </div>
    </main>

    <!-- Pokemon List Flyout Panel -->
    <div id="pokemon-flyout" class="flyout-panel">
        <div class="flyout-header">
            <h2>Add Pokémon</h2>
            <button id="close-flyout-btn" class="icon-btn" title="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flyout-filters">
            <div class="filter-row">
                <input type="text" id="search-input" placeholder="Search Pokémon...">
                <div class="filter-dropdown-container">
                    <button id="filter-btn" class="filter-btn">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                    <div id="filter-dropdown" class="filter-dropdown">
                        <div class="filter-section filter-checkbox">
                            <label>
                                <input type="checkbox" id="in-dex-filter">
                                <span>In Dex</span>
                            </label>
                        </div>
                        <div class="filter-section">
                            <label>Type</label>
                            <select id="type-select">
                                <option value="">Select type...</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <label>Generation</label>
                            <select id="gen-select">
                                <option value="">Select gen...</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <label>Evolution Stages</label>
                            <select id="evo-select">
                                <option value="">Select stages...</option>
                                <option value="1">1-Stage</option>
                                <option value="2">2-Stage</option>
                                <option value="3">3-Stage</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="view-toggle" class="icon-toggle view-toggle" title="Toggle View">
                    <i class="fas fa-list"></i>
                    <div class="toggle-slider"></div>
                    <i class="fas fa-th"></i>
                </div>
            </div>
            <div id="filter-chips" class="filter-chips"></div>
        </div>
        <div id="pokemon-list" class="pokemon-list">
            <!-- Pokemon items injected here -->
        </div>
    </div>
    <div id="flyout-overlay" class="flyout-overlay"></div>

    <!-- Template Selection Modal -->
    <div id="template-modal" class="modal">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close-btn hidden" title="Close">
                <i class="fas fa-times"></i>
            </button>
            <!-- Step 1: Main Menu -->
            <div id="modal-step-menu" class="modal-step">
                <h2>Welcome to DexLab</h2>
                <p class="modal-desc">Create and manage your custom Pokédex</p>
                <div class="modal-menu-grid">
                    <button class="modal-menu-btn" id="menu-new-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>New</span>
                        <small>Create a new Pokédex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-load-btn">
                        <i class="fas fa-folder-open"></i>
                        <span>Load</span>
                        <small>Open a saved Pokédex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-region-btn">
                        <i class="fas fa-globe"></i>
                        <span>By Region</span>
                        <small>Start with a regional dex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-import-btn">
                        <i class="fas fa-file-import"></i>
                        <span>Import</span>
                        <small>Load from JSON file</small>
                    </button>
                </div>
            </div>
            
            <!-- Step 2: New Dex Form -->
            <div id="modal-step-new" class="modal-step hidden">
                <button class="modal-back-btn" id="new-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Create New Pokédex</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label for="new-dex-name">Name</label>
                        <input type="text" id="new-dex-name" placeholder="My Custom Dex" maxlength="50">
                        <div class="char-counter"><span id="name-char-count">0</span> / 50</div>
                    </div>
                    <div class="form-group">
                        <label for="new-dex-desc">Description <span class="optional">(optional)</span></label>
                        <textarea id="new-dex-desc" placeholder="A brief description of your Pokédex..." rows="2" maxlength="100"></textarea>
                        <div class="char-counter"><span id="desc-char-count">0</span> / 100</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="new-start-btn" class="btn-primary"><i class="fas fa-rocket"></i> Start</button>
                </div>
            </div>
            
            <!-- Step 2b: Edit Dex Form -->
            <div id="modal-step-edit" class="modal-step hidden">
                <button class="modal-back-btn" id="edit-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Edit Pokédex</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label for="edit-dex-name">Name</label>
                        <input type="text" id="edit-dex-name" placeholder="My Custom Dex" maxlength="50">
                        <div class="char-counter"><span id="edit-name-char-count">0</span> / 50</div>
                    </div>
                    <div class="form-group">
                        <label for="edit-dex-desc">Description <span class="optional">(optional)</span></label>
                        <textarea id="edit-dex-desc" placeholder="A brief description of your Pokédex..." rows="2" maxlength="100"></textarea>
                        <div class="char-counter"><span id="edit-desc-char-count">0</span> / 100</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="edit-save-btn" class="btn-primary"><i class="fas fa-save"></i> Save</button>
                </div>
            </div>
            
            <!-- Step 3: Load Saved Dex -->
            <div id="modal-step-load" class="modal-step hidden">
                <button class="modal-back-btn" id="load-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Load Pokédex</h2>
                <div id="saved-dex-list" class="saved-dex-list">
                    <!-- Saved dexes injected here -->
                </div>
            </div>
            
            <!-- Step 4: By Region -->
            <div id="modal-step-region" class="modal-step hidden">
                <button class="modal-back-btn" id="region-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Select Region</h2>
                <div id="region-list" class="saved-dex-list">
                    <!-- Region templates injected here -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>
