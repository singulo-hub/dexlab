<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DexLab - Custom Pokédex Builder</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="stylesheet" href="styles/pokemon.css">
    <link rel="stylesheet" href="styles/modal.css">
    <link rel="stylesheet" href="styles/flyout.css">
    <link rel="stylesheet" href="libs/fontawesome/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="dexlab.svg">
    <script src="libs/chart.js/chart.umd.min.js"></script>
    <script type="module" src="scripts/app.js"></script>
</head>
<body>
    <header>
        <div class="header-title">
            <h1>DexLab</h1>
            <span class="title-separator">/</span>
            <span id="dex-name" class="dex-name">Untitled Dex</span>
            <button id="edit-dex-btn" class="icon-btn" title="Edit Pokédex">
                <i class="fas fa-edit"></i>
            </button>
            <span id="dex-count" class="dex-count"><span id="stat-total-count">0</span> Total</span>
        </div>
        <div class="header-controls">
            <button id="add-pokemon-btn"><i class="fas fa-plus"></i> Add Pokémon</button>
            <div class="actions-dropdown-container">
                <button id="actions-btn" class="actions-btn"><i class="fas fa-ellipsis-v"></i></button>
                <div id="actions-dropdown" class="actions-dropdown">
                    <button id="new-dex-btn"><i class="fas fa-file"></i> Change Dex</button>
                    <button id="export-btn"><i class="fas fa-file-export"></i> Export</button>
                </div>
            </div>
            <input type="file" id="file-input" style="display: none;" accept=".json">
            <div class="icon-toggle theme-toggle" id="theme-toggle" title="Toggle theme">
                <i class="fas fa-moon"></i>
                <div class="toggle-slider"></div>
                <i class="fas fa-sun"></i>
            </div>
        </div>
    </header>
    <main class="main-content">
        <div id="dashboard" class="dashboard">
            <div class="stat-card span-2-cols" id="stat-alerts">
                <h3>
                    Alerts
                    <span class="help-icon" data-tooltip="Alerts highlight unusual patterns in your dex data. These patterns aren't inherently bad; many official regions have them by design. Use alerts as signals to review balance or consider context, not as strict warnings.">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </h3>
                <ul id="alert-list"></ul>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-egg-chart">
                <h3>Egg Group Distribution</h3>
                <div class="chart-container">
                    <canvas id="egg-chart"></canvas>
                </div>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-capture-chart">
                <div class="chart-header">
                    <h3>CR Distribution</h3>
                    <div class="icon-toggle chart-view-toggle" id="capture-chart-toggle" title="Toggle chart view">
                        <i class="fas fa-chart-column"></i>
                        <div class="toggle-slider"></div>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="capture-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Min: <strong id="min-cr-val">-</strong></span>
                    <span>Q1: <strong id="q1-cr-val">-</strong></span>
                    <span>Median: <strong id="median-cr-val">-</strong></span>
                    <span>Q3: <strong id="q3-cr-val">-</strong></span>
                    <span>Max: <strong id="max-cr-val">-</strong></span>
                </div>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-type-chart">
                <h3>Type Distribution</h3>
                <div class="chart-container">
                    <canvas id="type-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Rare: <strong id="rare-type-val">-</strong></span>
                    <span>Common: <strong id="common-type-val">-</strong></span>
                </div>
            </div>
            <div class="stat-card chart-card span-2-cols span-2-rows" id="stat-bst-chart">
                <div class="chart-header">
                    <h3>BST Distribution</h3>
                    <div class="icon-toggle chart-view-toggle" id="bst-chart-toggle" title="Toggle chart view">
                        <i class="fas fa-chart-column"></i>
                        <div class="toggle-slider"></div>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="bst-chart"></canvas>
                </div>
                <div class="chart-stats">
                    <span>Min: <strong id="min-bst-val">-</strong></span>
                    <span>Q1: <strong id="q1-bst-val">-</strong></span>
                    <span>Median: <strong id="median-bst-val">-</strong></span>
                    <span>Q3: <strong id="q3-bst-val">-</strong></span>
                    <span>Max: <strong id="max-bst-val">-</strong></span>
                </div>
            </div>
            <div class="stat-card" id="stat-evolution">
                <div class="stat-breakdown">
                    <h3>Evolution Stages</h3>
                    <span>1-Stage: <strong id="stat-1stage">-</strong></span>
                    <span>2-Stage: <strong id="stat-2stage">-</strong></span>
                    <span>3-Stage: <strong id="stat-3stage">-</strong></span>
                    <span>Late: <strong id="stat-late-evo">-</strong></span>
                </div>
            </div>
            <div class="stat-card" id="stat-special">
                <div class="stat-breakdown">
                    <h3>Special Pokemon</h3>
                    <span>Legendary: <strong id="stat-legendary">-</strong></span>
                    <span>Mythical: <strong id="stat-mythical">-</strong></span>
                    <span>Pseudo: <strong id="stat-pseudo">-</strong></span>
                    <span>Total: <strong id="stat-special-total">-</strong></span>
                </div>
            </div>
        </div>
    </main>

    <!-- Pokemon List Flyout Panel -->
    <div id="pokemon-flyout" class="flyout-panel">
        <div class="flyout-header">
            <h2>Add Pokémon</h2>
            <button id="close-flyout-btn" class="icon-btn" title="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="flyout-filters">
            <div class="filter-row filter-row-search">
                <input type="text" id="search-input" placeholder="Search Pokémon...">
            </div>
            <div class="filter-row filter-row-controls">
                <div class="filter-dropdown-container">
                    <button id="filter-btn" class="filter-btn">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                    <div id="filter-dropdown" class="filter-dropdown">
                        <div class="filter-section filter-checkbox">
                            <label>
                                <input type="checkbox" id="in-dex-filter">
                                <span>In Dex</span>
                            </label>
                        </div>
                        <div class="filter-section filter-bst">
                            <label>BST</label>
                            <div class="bst-range-labels">
                                <span>MIN <strong id="bst-min-val">180</strong></span>
                                <span>MAX <strong id="bst-max-val">780</strong></span>
                            </div>
                            <div class="range-slider">
                                <input type="range" id="bst-min" min="180" max="780" value="180" step="10">
                                <input type="range" id="bst-max" min="180" max="780" value="780" step="10">
                                <div class="range-track"></div>
                                <div class="range-selected" id="bst-range-selected"></div>
                                <div class="range-selected range-selected-left" id="bst-range-left"></div>
                                <div class="range-selected range-selected-right" id="bst-range-right"></div>
                            </div>
                        </div>
                        <div class="filter-section filter-cr">
                            <label>CR</label>
                            <div class="cr-range-labels">
                                <span>MIN <strong id="cr-min-val">3</strong></span>
                                <span>MAX <strong id="cr-max-val">255</strong></span>
                            </div>
                            <div class="range-slider">
                                <input type="range" id="cr-min" min="3" max="255" value="3" step="1">
                                <input type="range" id="cr-max" min="3" max="255" value="255" step="1">
                                <div class="range-track"></div>
                                <div class="range-selected" id="cr-range-selected"></div>
                            </div>
                        </div>
                        <div class="filter-section">
                            <label>Type</label>
                            <select id="type-select">
                                <option value="">Select type...</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <label>Generation</label>
                            <select id="gen-select">
                                <option value="">Select gen...</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <label>Evolution Stages</label>
                            <select id="evo-select">
                                <option value="">Select stages...</option>
                                <option value="1">1-Stage</option>
                                <option value="2">2-Stage</option>
                                <option value="3">3-Stage</option>
                            </select>
                        </div>
                        <div class="filter-section">
                            <label>Egg Group</label>
                            <select id="egg-select">
                                <option value="">Select egg group...</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="filter-row-toggles">
                    <div id="egg-toggle" class="icon-toggle egg-toggle active" title="Toggle Egg Groups">
                        <i class="fas fa-egg"></i>
                    </div>
                    <div id="stats-toggle" class="icon-toggle stats-toggle active" title="Toggle Stats">
                        <i class="fas fa-hashtag"></i>
                    </div>
                    <div id="view-toggle" class="icon-toggle view-toggle" title="Toggle View">
                        <i class="fas fa-list"></i>
                        <div class="toggle-slider"></div>
                        <i class="fas fa-th"></i>
                    </div>
                </div>
            </div>
            <div id="filter-chips" class="filter-chips"></div>
        </div>
        <div id="pokemon-list" class="pokemon-list">
            <!-- Pokemon items injected here -->
        </div>
    </div>
    <div id="flyout-overlay" class="flyout-overlay"></div>

    <!-- Template Selection Modal -->
    <div id="template-modal" class="modal">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close-btn hidden" title="Close">
                <i class="fas fa-times"></i>
            </button>
            <!-- Step 1: Main Menu -->
            <div id="modal-step-menu" class="modal-step">
                <h2>Welcome to DexLab</h2>
                <p class="modal-desc">Create and manage your custom Pokédex</p>
                <div class="modal-menu-grid">
                    <button class="modal-menu-btn" id="menu-new-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>New</span>
                        <small>Create a new Pokédex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-load-btn">
                        <i class="fas fa-folder-open"></i>
                        <span>Load</span>
                        <small>Open a saved Pokédex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-region-btn">
                        <i class="fas fa-globe"></i>
                        <span>By Region</span>
                        <small>Start with a regional dex</small>
                    </button>
                    <button class="modal-menu-btn" id="menu-import-btn">
                        <i class="fas fa-file-import"></i>
                        <span>Import</span>
                        <small>Load from JSON file</small>
                    </button>
                </div>
            </div>
            
            <!-- Step 2: New Dex Form -->
            <div id="modal-step-new" class="modal-step hidden">
                <button class="modal-back-btn" id="new-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Create New Pokédex</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label for="new-dex-name">Name</label>
                        <input type="text" id="new-dex-name" placeholder="My Custom Dex" maxlength="50">
                        <div class="char-counter"><span id="name-char-count">0</span> / 50</div>
                    </div>
                    <div class="form-group">
                        <label for="new-dex-desc">Description <span class="optional">(optional)</span></label>
                        <textarea id="new-dex-desc" placeholder="A brief description of your Pokédex..." rows="2" maxlength="100"></textarea>
                        <div class="char-counter"><span id="desc-char-count">0</span> / 100</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="new-start-btn" class="btn-primary"><i class="fas fa-rocket"></i> Start</button>
                </div>
            </div>
            
            <!-- Step 2b: Edit Dex Form -->
            <div id="modal-step-edit" class="modal-step hidden">
                <button class="modal-back-btn" id="edit-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Edit Pokédex</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label for="edit-dex-name">Name</label>
                        <input type="text" id="edit-dex-name" placeholder="My Custom Dex" maxlength="50">
                        <div class="char-counter"><span id="edit-name-char-count">0</span> / 50</div>
                    </div>
                    <div class="form-group">
                        <label for="edit-dex-desc">Description <span class="optional">(optional)</span></label>
                        <textarea id="edit-dex-desc" placeholder="A brief description of your Pokédex..." rows="2" maxlength="100"></textarea>
                        <div class="char-counter"><span id="edit-desc-char-count">0</span> / 100</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="edit-save-btn" class="btn-primary"><i class="fas fa-save"></i> Save</button>
                </div>
            </div>
            
            <!-- Step 3: Load Saved Dex -->
            <div id="modal-step-load" class="modal-step hidden">
                <button class="modal-back-btn" id="load-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Load Pokédex</h2>
                <p class="modal-note"><i class="fas fa-info-circle"></i> When you clear your browser cache, all saved Pokédexes go, too. Be sure to export the data when you are done!</p>
                <div id="saved-dex-list" class="saved-dex-list">
                    <!-- Saved dexes injected here -->
                </div>
            </div>
            
            <!-- Step 4: By Region -->
            <div id="modal-step-region" class="modal-step hidden">
                <button class="modal-back-btn" id="region-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Select Region</h2>
                <div id="region-list" class="saved-dex-list">
                    <!-- Region templates injected here -->
                </div>
            </div>
            
            <!-- Step 5: Export Menu -->
            <div id="modal-step-export" class="modal-step hidden">
                <h2>Export Pokédex</h2>
                <p class="modal-desc">Choose an export format</p>
                <div class="modal-menu-grid modal-menu-2col">
                    <button class="modal-menu-btn" id="export-data-btn">
                        <i class="fas fa-database"></i>
                        <span>Data</span>
                        <small>Export as a JSON file</small>
                    </button>
                    <button class="modal-menu-btn" id="export-grid-btn">
                        <i class="fas fa-th"></i>
                        <span>Grid</span>
                        <small>Save as a Pokémon grid image</small>
                    </button>
                </div>
            </div>
            
            <!-- Step 6: Export Grid Options -->
            <div id="modal-step-export-grid" class="modal-step hidden">
                <button class="modal-back-btn" id="export-grid-back-btn">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <h2>Grid Image Options</h2>
                <div class="modal-form">
                    <div class="form-group">
                        <label class="image-style-label">Image Style</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="grid-image-style" value="artwork" checked>
                                <span class="radio-label">Official Artwork</span>
                                <small>High-quality official artwork</small>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="grid-image-style" value="sprite">
                                <span class="radio-label">Sprites</span>
                                <small>Pixel art game sprites</small>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="grid-show-names">
                            <span>Show Pokémon names</span>
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="export-grid-generate-btn" class="btn-primary"><i class="fas fa-gears"></i> Generate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <i id="toast-icon" class="fas fa-spinner fa-spin"></i>
        <span id="toast-message">Loading...</span>
    </div>
</body>
</html>
